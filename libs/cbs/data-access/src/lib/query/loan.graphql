fragment LoanProduct on LoanProduct {
  id
  objState
  createdAt
  modifiedAt
  createdDate
  productName
  productType
  productSubType
  productNature
  description
  productCode {
    prefix
    initialNo
  }
  productCodeString
  typeOfMember
  criteria
  minAge
  maxAge
  genderId
  maritalStatusId
  educationQualification
  ethnicity
  occupation
  foreignEmployment
  natureOfBusinessInstitution
  natureOFBusinessCoop
  cooperativeType
  tenureUnit
  isTenureApplicable
  minTenureUnitNumber
  maxTenureUnitNumber
  minimumLoanAmount
  maxLoanAmount
  interestMethod
  repaymentScheme
  allowPartialInstallment
  isMonthlyInstallmentCompulsory
  isPenaltyApplicable
  penaltyDayAfterInstallmentDate
  penaltyType
  penaltyRate
  penaltyAmount
  principalMaxGraceNumber
  interestMaxGraceNumber
  isRebateApplicable
  rebate {
    dayBeforeInstallmentDate
    rebateRate
    rebateAmount
    rebateLedgerMapping
  }
  interest {
    minRate
    maxRate
    defaultRate
    ceoAuthority
    boardAuthority
  }
  updateInterest
  waiveInterest
  postingFrequency
  loanProcessingCharge {
    serviceName
    ledgerName
    amount
  }
  isInsuranceApplicable
  insuranceType {
    type
    amount
    rate
  }
  ledgerMapping {
    principal
    interestAccuredDaily
    interestIncome
  }
  isStaffProduct
  supportMultipleAccounts
  loanScheduleChangeOverride
  allowGurantee
  maxPercentOfGurantee
  isCollateralRequired
  collateralTypes
  collateralValue {
    type
    name
    minFMV
    maxFMV
    minDV
    maxDV
    minValue
    maxValue
  }
  prematurePenaltySetup {
    penaltyDateType
    noOfDays
    penaltyLedgerMapping
    penaltyAmount
    penaltyRate
  }
  requiredDocuments
}

query getLoanProductDetailsData($id: ID!) {
  settings {
    general {
      loanProducts {
        formState(id: $id) {
          data {
            ...LoanProduct
          }
          error {
            ...QueryError
          }
        }
      }
    }
  }
}

query getLoanProductsList($memberId: ID!, $productTypeId: ID!, $productSubTypeId: ID!) {
  loanAccount {
    getProductList(
      memberId: $memberId
      productSubTypeId: $productSubTypeId
      productType: $productTypeId
    ) {
      allowed {
        id
        productName
      }
      notAllowed {
        data {
          id
          productName
        }
        error
      }
    }
  }
}

query getProductCriteria($productId: ID!) {
  loanAccount {
    getProductCriteria(productId: $productId) {
      data {
        gender
        minAge
        maxAge
        ethnicity
        educationQualification
        occupation
        foreignEmployment
        institutionType
        cooperativeUnion
        cooperativeType
        maritalStatus
      }
      error {
        ...QueryError
      }
    }
  }
}

query getLoanAccountType($productTypeId: String) {
  settings {
    general {
      loan {
        productType {
          productTypes {
            id
            productType
          }
          productSubTypes(productTypeID: $productTypeId) {
            id
            productSubType
          }
        }
      }
    }
  }
}

query getLoanProductTypes {
  settings {
    general {
      loan {
        productType {
          productTypes {
            id
            productType
            description
          }
        }
      }
    }
  }
}

query getCollateralList {
  settings {
    general {
      loan {
        general {
          collateralList {
            id
            name
          }
        }
      }
    }
  }
}

query getLoanList($paginate: Pagination, $filter: LoanAccountSearchFilter) {
  loanAccount {
    list(paginate: $paginate, filter: $filter) {
      totalCount
      edges {
        cursor
        node {
          id
          member {
            id
            name
            profilePicUrl
          }
          product {
            productName
          }
          LoanAccountName
          createdAt
        }
      }
      pageInfo {
        endCursor
        startCursor
        hasNextPage
        hasPreviousPage
      }
    }
  }
}

query getLoanInstallments(
  $productId: ID!
  $gracePeriod: LoanAccountGraceInput
  $sanctionAmount: Int!
  $tenure: Int!
  $interest: Float!
  $repaymentScheme: LoanRepaymentScheme!
) {
  loanAccount {
    getLoanInstallments(
      interest: $interest
      gracePeriod: $gracePeriod
      productId: $productId
      repaymentScheme: $repaymentScheme
      sanctionAmount: $sanctionAmount
      tenure: $tenure
    ) {
      data {
        total
        installments {
          interest
          installmentDate
          installmentNo
          payment
          principal
          remainingPrincipal
          interest
        }
      }
      error {
        ...QueryError
      }
    }
  }
}

query getLoanApplicationDetails($id: ID!) {
  loanAccount {
    formState(id: $id) {
      data {
        memberId
        productType
        productSubType
        productId
        loanAccountName
        appliedLoanAmount
        collateralData {
          collateralType
          ownerName
          relation
          sheetNo
          plotNo
          kittaNo
          area
          buildingType
          constructionType
          valuatorId
          noOfStorey
          fmvMaxAmount
          dvMinAmount
          valuationMethod
          valuationPercent
          collaterallValuation
          collateralDescription
          collateralFiles
          valuationFiles
          vehicleName
          vehicleModelNo
          vehicleRegistrationNo
          vehicleNo
          vehicleSeatCapacity
          vehicleCapacity
          vehicleType
          vehicleFuelType
          documentName
          valuationAmount
          description
        }
        gurantee_details {
          accountId
          guranteeAmount
          maxGuranteeAmountLimit
          memberId
          totalAmount
          accountName
        }
        gracePeriod {
          principalGracePeriod
          interestGracePeriod
        }
        linkedAccountId
        totalValuation
        totalSanctionedAmount
        justifySanction
        interestAuthority
        interestDoc {
          identifier
          url
        }
        intrestRate
        tenure
        tenureType
        repaymentScheme
        loanProcessingCharge {
          amount
          ledgerName
          serviceName
        }
        note
      }
      error {
        ...QueryError
      }
    }
  }
}

query getMemberLoanAccounts($memberId: ID!) {
  loanAccount {
    memberDisbursedLoanAccounts(memberId: $memberId) {
      id
      name
    }
  }
}

query getLoanPreview($id: String!) {
  loanAccount {
    loanPreview(loanAccountId: $id) {
      data {
        productId
        additionalFeatures {
          allowPartialInstallment
          collateral
          insurance
          isMonthlyInterestCompulsory
          loanScheduleChangeOverride
          overrideInterest
          staffProduct
          supportMultipleAccount
        }
        criteria {
          gender
          minAge
          maxAge
          ethnicity
          educationQualification
          maritalStatus
          foreignEmployment
          occupation
          institutionType
          cooperativeUnion
          cooperativeType
        }
        collateralAndGuarantees {
          name
          valuation
        }
        generalInformation {
          loanProduct
          loanSubType
          loanType
          natureOfLoanProduct
          loanName
          productCode
        }
        loanDetails {
          appliedLoanAmount
          interestMethod
          interestRate
          loanRepaymentScheme
          tenure
          tenureUnit
          totalCollateralValuation
          totalGuaranteeValuation
          totalProcessingChargesValuation
          totalSanctionedAmount
          totalDisbursedAmount
          principalGracePeriod
          interestGracePeriod
          interestAmount
          disburseDate
          expiryDate
          paymentFrequency
          processingCharges {
            name
            amount
          }
        }
        repaymentDetails {
          lastPaymentDate
          remainingPrincipal
          remainingInterest
          remainingTotal
          remainingInstallments {
            installmentNo
            principal
            fine
            interestAmount
          }
          totalInstallmentAmount
          nextInstallmentNo
        }
        member {
          name
          id
          profilePicUrl
        }

        memberId
        productId
        paymentSchedule {
          total
          installments {
            installmentDate
            installmentNo
            interest
            payment
            principal
            remainingPrincipal
            paid
          }
        }
        statistics {
          remainingPayableAmount
          totalPaidAmount
          totalPayableAmount
        }
      }
    }
  }
}

query getLoanRepaymentList($paginate: Pagination, $filter: LoanRepaymentFilter) {
  loanAccount {
    repaymentList(paginate: $paginate, filter: $filter) {
      totalCount
      edges {
        node {
          id
          loanAccountId
          memberId
          memberName
          memberProfilePicId
          memberProfilePicUrl
          loanAccountName
          loanProductId
          loanProductName
          amount
          paymentDate
        }
        cursor
      }
      pageInfo {
        hasNextPage
        hasPreviousPage
        startCursor
        endCursor
      }
    }
  }
}
